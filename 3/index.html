<!DOCTYPE html>
<html>
  <head>
  <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="author" content="" />

    <link rel="stylesheet" type="text/css" href="http://defav.lt/css/root.css" media="screen" />
    <script type="text/javascript" src="http://defav.lt/js/prefixfree.min.js"></script>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Recruitment test</title>
  </head>
  
  	<body class="id_3">
  
  
 
 
<header>
	<nav>
		
		
		
			
			
			
			
				
					
					

			
			

			
			
				
				

				<a title="" href="http://defav.lt/2/">previous</a>
				<a class="disabled">next</a>
			
			
			
			<a href="http://defav.lt">home</a>
			
		
	</nav>
</header>


	<article>
	
	
	<h1 >
		
			Recruitment test
		
</h1>
	
<p>
	Solving the recruitment test from Multisoft Solutions
</p>

	
	<ol>
<li><a href="#Background">Background</a></li>
<li><a href="#Problem">Problem</a></li>
<li><a href="#Solution">Solution</a></li>
</ol>


                            <h2  id="Background">
                                <a href="#Background">Background</a>
                                <a href="#top"> *</a>
                            </h2>"


<p>A couple of days ago (read: early new years eve) I looked through a couple of job ads on (the very ugly) <a href="http://vakanser.se/">vakanser.se</a> website and stumbled upon (ergh) an <a href="http://www.multisoft.se/softadmin.aspx?id=11&amp;menuid=ST16">ad</a> from swedish firm <a href="multisoft.se">Multisoft Solutions</a>. While pondering over the solution I thought to myself "hey, why not put it on <a href="/">there</a>". Said and done, here it is:</p>

                            <h2  id="Problem">
                                <a href="#Problem">Problem</a>
                                <a href="#top"> *</a>
                            </h2>"


<p>Imagine the following procedure in <a href="http://en.wikipedia.org/wiki/T-sql">T-SQL</a>:</p>

<pre><code>CREATE PROCEDURE dbo.ObscureProcedure
    @i int
AS
BEGIN
    SELECT
        CASE
            WHEN @i &lt; 193 THEN
                COUNT(*) * @i
            ELSE
                COUNT(*) * 193
        END AS ObscureCount
    FROM
        VacationGadget
    WHERE
        @i &lt; 886
END
</code></pre>

<p>The logic should be simple enough to follow.</p>

<p>The task at hand, is to figure what the following code would return:</p>

<pre><code>long sum = 0;
for (int i = 0; i &lt; 891; i++)
{
    sum += GetIntFromSQL("EXEC dbo.ObscureProcedure @i = " + i.ToString());
}

return sum;
</code></pre>

<p>*Side note: That piece of code is horrible. Never, ever do something like it. Thank you.</p>

<p>Now, running the following statement (in the sql server):</p>

<pre><code>EXEC dbo.ObscureProcedure @i = 496
</code></pre>

<p>Would give you the answer</p>

<pre><code>ObscureCount
------------
1999287

(1 row(s) affected)
</code></pre>

                            <h2  id="Solution">
                                <a href="#Solution">Solution</a>
                                <a href="#top"> *</a>
                            </h2>"


<p>Now, thing is, they've pretty much already given us the answer. The steps from here to a solution is pretty clear:</p>

<ol>
<li><p><strong>Convert</strong> the SQL procedure into a function</p></li>
<li><p><strong>Test</strong> the function</p></li>
<li><p><strong>??</strong></p></li>
<li><p><strong>Profit</strong> (or not..)</p></li>
</ol>


<p>Let's start with the test. Set this up in a unit test (I used nunit, but use whatever you want):</p>

<pre><code>Assert.AreEqual(1999287, dbo.ObscureProcedure(496));
</code></pre>

<p>This (of course) will fail the first time it's run, but worry not. We'll soon make it spew green into your eyes.
Since the procedure uses <code>COUNT(*)</code> we need to calculate the number of rows the table's got. Our procedure doesn't use <code>@i</code> unless
it's <code>lt</code> 193 so we need to <code>1999287 / 193</code> which'll give us <code>10359</code>.</p>

<p>The next step in our path to glory would be tracing the control flow in the procedure, and rebuild it (in your language of choice):</p>

<pre><code>public static int ObscureProcedure(int i) 
{
    const int rows = 10359 //remember?

    if (i &gt;= 886) //WHERE @i &lt; 886
        return 0;

    if (i &lt; 193) //CASE WHEN @i &lt; 193 THEN COUNT(*) * @i
        return rows * i; 
    else
        return rows * 193;
}
</code></pre>

<p>And that should be pretty self-explanatory. Simply put:</p>

<ol>
<li><p>The <strong>WHERE</strong> clause in SQL must be evaluated first since that's what the SQL server does</p></li>
<li><p><strong>Continue</strong> as in the original procedure</p></li>
</ol>


<p>That's it. You could probably do things in another way, like using a switch-case and some clever subtraction or multiplication. But why bother? Besides, using stuff like that in production environments would just be stupid. But if you do, you should probably switch <a href="http://www.youtube.com/watch?v=0zxxM9EYQzY">profession</a>.</p>

</article>
	
  </body>
  
  <link rel="stylesheet" href="//yandex.st/highlightjs/8.0/styles/tomorrow-night-bright.min.css">
  <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>

  <script type="text/javascript" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
  <script type="text/javascript" src="http://defav.lt/js/root.js"></script>

  <script type="text/javascript">
    if (hljs !== undefined)
        hljs.initHighlightingOnLoad();
  </script>
</html>
