<!DOCTYPE html>
<html>
  <head>
  <meta charset='utf-8' />
    <!--[if IE]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="" />

    <link data-noprefix href='//fonts.googleapis.com/css?family=Roboto:700,400italic,100,400,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css' />
    <link data-noprefix href='//raw.github.com/daneden/animate.css/master/animate.css' rel='stylesheet' type='text/css' />
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/css/root.css" media="screen" />
    <script type="text/javascript" src="http://localhost:4000/js/prefixfree.min.js"></script>

    <link href="//yandex.st/highlightjs/8.0/styles/tomorrow-night-bright.min.css" rel="stylesheet" type="text/css" />

    <title>The life and times of 0x44 aka Arch, the headless haunt</title>
  </head>
  
  	<body class="id_5">
  
  
 
 
<header>
	<nav>
		
		
		<a href="http://localhost:4000">home</a>

		
			
			
			
			
				
					
					

			
			

			
			
				
				

				<a title="" href="http://localhost:4000/4/">previous</a>
				<a class="disabled">next</a>
			
			
			
			
		
	</nav>
</header>


	<article>
	
	
    
    <h1 >
		
			The life and times of 0x44 aka Arch, the headless haunt
		
</h1>
	



	<ol>
<li><a href="#Prerequisites">Prerequisites</a></li>
<li><a href="#Installing-cross-build-tools">Installing crossbuild tools</a></li>
<li><a href="#Get-the-kernel" title="And patch it too!">Get the kernel</a></li>
<li><a href="#Time-for-compilation">Time for compilation</a></li>
<li><a href="#Run-it!">Run it!</a></li>
</ol>


<p>This will probably be quite a short post, but hey, who cares.</p>

<p>At least I'll have this somewhere next time I need to do it (seriously, <em>every</em> time I upgrade my system apt eats the crossbuild essentials and libncurses dev package (I know, my system is broken, but I couldn't care less, I'm living on the edge!)).</p>

                            <h2  id="Prerequisites">
                                <a href="#Prerequisites">Prerequisites</a>
                                <a href="#top"> *</a>
                            </h2>


<ul>
<li>Qemu installed</li>
<li>A disk, or an image, for your headless friend</li>
<li>Linux kernel sources‚Å∫</li>
<li>Debian Jessie/Testing</li>
</ul>


                            <h2  id="Installing-crossbuild-tools">
                                <a href="#Installing-crossbuild-tools">Installing crossbuild tools</a>
                                <a href="#top"> *</a>
                            </h2>


<p>Since I'm on Debian Jessie/Testing, things work a little different than for most people* meaning you can't just go <code># apt-get install gcc-arm-linux-gnueabihf</code> (or whatever the name of the package is on your flavor) and think you can <code>make</code> for arm.</p>

<p>Actually, no, you can. You just have to add the correct sources first.</p>

<pre><code># echo "deb http://emdebian.org/tools/debian/ jessie main" &gt; /etc/source.list.d/crosstools.list
</code></pre>

<p>And the correct archive key:</p>

<pre><code>wget -O- http://emdebian.org/tools/debian/emdebian-toolchain-archive.key | sudo apt-key add -
</code></pre>

<p>You'll need to add your target architecture as well, like so:</p>

<pre><code># dpkg -add-architecture armhf
</code></pre>

<p>Now you can go ahead and install your tools (you should probably update apt first):</p>

<pre><code># apt-get install crossbuild-essential-armhf libncurses5-dev
</code></pre>

<p>(If you just wan't the compiler there's a chance <code>gcc-arm-linux-gnueabihf</code> might work, but I haven't tested that)</p>

                            <h2  id="Get-the-kernel">
                                <a href="#Get-the-kernel">Get the kernel</a>
                                <a href="#top"> *</a>
                            </h2>


<p>I got mine from <code>https://github.com/raspberrypi/linux.git</code>, I suspect you'll wan't to do the same (if you're on ARM11 that is).</p>

<p>After you've created a work directory, get it with</p>

<pre><code>$ git clone https://github.com/raspberrypi/linux.git
</code></pre>

<p>Then, you'll need to patch the kernel. get it likes so:</p>

<pre><code>$ wget -O- http://xecdesign.com/downloads/linux-qemu/linux-arm.patch | patch -p1 -d linux/
</code></pre>

                            <h2  id="Time-for-compilation">
                                <a href="#Time-for-compilation">Time for compilation</a>
                                <a href="#top"> *</a>
                            </h2>


<p>When that's done, start the configuration procedure (this is fun stuff!):</p>

<pre><code>$ cd linux
$ make ARCH=arm versatile_defconfig
$ make ARCH=arm menuconfig
</code></pre>

<p>You should've gotten an ugly menu thingie up by now. Make your configurations as necessary and the compile the kernel:</p>

<pre><code>$ make ARCH=arm
$ make ARCH=arm INSTALL_MOD_PATH=../modules modules_install
</code></pre>

<p>Your kernel should be ripe for the taking in <code>arch/arm/boot/</code>.
Neat!</p>

                            <h2  id="Run-it!">
                                <a href="#Run-it!">Run it!</a>
                                <a href="#top"> *</a>
                            </h2>


<p>Here comes the fun part.</p>

<p>Bascially, you'll do</p>

<pre><code>$/# qemu-system-arm -kernel &lt;kernel&gt; -cpu arm1176 -m 256 -M versatilepb -no-reboot -serial stdio -append "&lt;parameters&gt;" -hda &lt;image&gt;
</code></pre>

<p>There's a couple of things of note here:</p>

<ol>
<li><p><kernel>
The kernel image we compiled before</p></li>
<li><p><parameters>
Any <a href="http://man7.org/linux/man-pages/man7/bootparam.7.html">boot time parameters</a> you'd want. I used the following combination:
 root=/dev/sda2 rootfstype=ext4 rw init=/bin/bash</p></li>
</ol>


<p>  Since I'm prepping for a deployment I'm not using <code>panic</code> here, but when I deploy I'm gonna go with <code>panic=5</code>, as usual, which in the event of a kernel panic, reboots the unit after 5 seconds.</p>

<ol>
<li><image>
Simple, your disk image. Either get one from <a href="http://www.raspberrypi.org/downloads/">somewhere</a> or <a href="http://archlinuxarm.org/platforms/armv6/raspberry-pi">something</a> <a href="http://www.linuxfromscratch.org/">else</a>. Since I only needed to install some software from an offsite location (I'm on a &lt;1MB 3G connection. Yes, that's dial-up speeds) I used the actuall SD-card I use when deployed.
Depending on your choice for hda, you might need to use sudo while starting qemu.</li>
</ol>


<p>* Most people: Users of ubuntu and derivatives</p>

</article>

	
      <script type="text/javascript" src="//yandex.st/highlightjs/8.0/highlight.min.js"></script>
      <script type="text/javascript" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
      <script type="text/javascript" src="http://localhost:4000/js/root.js"></script>

      <script type="text/javascript">
        if (hljs !== undefined)
            hljs.initHighlightingOnLoad();
      </script>
  </body>
</html>
